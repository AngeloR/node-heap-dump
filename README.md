
node-heap-dump
==============

Overview
--------

This is a collection of programs for creating and viewing Node heap dumps using
V8 snapshots.  This was an experiment to see what run-time structures could be
viewed post-mortem using heap snapshots.

There are the following components:

- pmd.cc: add-on that provides one function, `takeSnapshot`, that takes a new
  heapsnapshot and serializes it as JSON to stdout (using the built-in V8
  mechanism for this).
- sample.js: simple script that uses the "pmd" add-on to generate a heap snapshot.
- heap-dump.js: a class called HeapDump that parses serialized heap snapshots.
  This is probably the component most likely to be useful for other projects
  because it parses the heap snapshot pretty generically.
- heapreader.js: a program that takes a heap dump generated by the "pmd"
  add-on, parses it using heap-dump.js, and summarizes the results.

The heap snapshot parser is pretty basic: it resolves references to strings,
type names, etc. but does *not* resolve references to other nodes.  This would
be easy to add as a second pass.

Note that the heap snapshot is a relatively compact representation; the
in-memory representation generated by this parser is substantially larger.


Example
-------

    # install dependencies
    npm install sprintf

    # build the add-on
    node-waf configure
    node-waf build
    node-waf install

    # generate a heap snapshot
    node sample.js > heapsnapshot

    # summarize the snapshot
    node heapreader.js heapsnapshot > heapsummary.txt


Resources
---------

The snapshot format is documented here:

    http://izs.me/v8-docs/classv8_1_1HeapSnapshot.html#acf7383deaa06fab1d948fd7e737ac7d3
